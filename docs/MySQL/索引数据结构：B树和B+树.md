# B+树

## 数据结构

假如 m 表示B+树的阶数：

1. 每个节点最多可以存储 m-1 个关键词；
2. 根节点最少可以有1个关键词；非根节点最少有 m/2 （向下取整）个关键词
3. 每个节点关键都从小到大排序，节点关键字大于左子树中所有关键字，小于右子树所有关键字；
4. 根节点到叶子节点高度相同
5. B+树分为内部节点和叶子节点，内部节点只存储索引(key)，叶子节点存储key/value；
6. 每个叶子节点都存有指针指向相邻的右叶子节点；

## 插入

执行插入的时候，如果kv元素插入叶子节点之后，叶子节点存储的元素数量，不满足`m/2 < kv < m-1` ，叶子节点需要进行分裂；

分裂规则：假如当前是B+树的阶数为 5 ，叶子节点分裂为两个节点，左节点两个元素、右节点三个元素；同时中间元素的key插入到父节点中；如果父节点不满足基本规则，需要按照相同的方式进行分裂；

## 删除

因为B+树所有的元素都存储在叶子节点，所以删除操作需要先找到叶子节点的元素，执行删除；之后判断元素删除后的节点是否满足基本规则；如果仍然满足规则，更新父节点索引，完成删除；如果不满足基本规则，则需要执行合并或者从相邻节点借元素；

## B+树的优点

1. 非叶子节点由于只存储索引，可存储更多的数据；也就是可以支持更高的阶数，更高的阶数意味着B+树的高度也会相应的降低；在查询过程中可以有效降低IO访问次数，查询速度更快，更稳定；
2. 由于相邻的叶子节点间存在指针链接，可以进行高效的范围查询；

 